<section class="py-8">
    <div class="max-w-6xl mx-auto px-4">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Manajemen Member</h1>
            <a href="/admin/members/create" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                <i class="fas fa-plus mr-2"></i>Tambah Member
            </a>
        </div>

        <!-- Search & Filter -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                <!-- Search Form -->
                <form action="/admin/members" method="GET" class="flex gap-2 flex-1">
                    <input type="hidden" name="status" value="<%= currentStatus %>">
                    <div class="relative flex-1 max-w-md">
                        <input type="text" name="search" value="<%= search %>"
                            placeholder="Cari Nama, NIPP, atau NIAS..."
                            class="w-full px-4 py-2 pl-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                        Cari
                    </button>
                    <% if (search) { %>
                        <a href="/admin/members?status=<%= currentStatus %>"
                            class="bg-gray-200 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-300">
                            Reset
                        </a>
                        <% } %>
                </form>

                <!-- Status Filter -->
                <div class="flex gap-2 flex-wrap">
                    <a href="/admin/members<%= search ? '?search=' + search : '' %>"
                        class="px-4 py-2 rounded-lg <%= currentStatus === 'all' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200' %>">
                        Semua
                    </a>
                    <a href="/admin/members?status=pending<%= search ? '&search=' + search : '' %>"
                        class="px-4 py-2 rounded-lg <%= currentStatus === 'pending' ? 'bg-yellow-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200' %>">
                        Pending
                    </a>
                    <a href="/admin/members?status=approved<%= search ? '&search=' + search : '' %>"
                        class="px-4 py-2 rounded-lg <%= currentStatus === 'approved' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200' %>">
                        Approved
                    </a>
                    <a href="/admin/members?status=rejected<%= search ? '&search=' + search : '' %>"
                        class="px-4 py-2 rounded-lg <%= currentStatus === 'rejected' ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200' %>">
                        Rejected
                    </a>
                </div>
            </div>

            <!-- Results Info -->
            <div class="mt-3 text-sm text-gray-500">
                Menampilkan <%= members.length %> dari <%= totalMembers %> member
                        <% if (search) { %>
                            untuk pencarian "<strong>
                                <%= search %>
                            </strong>"
                            <% } %>
            </div>
        </div>

        <!-- Members Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">Foto</th>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">Nama</th>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">NIPP</th>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">NIAS</th>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">Status</th>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">Tanggal Daftar</th>
                            <th class="px-4 py-3 text-sm font-medium text-gray-600">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        <% if (members.length===0) { %>
                            <tr>
                                <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                    <% if (search) { %>
                                        Tidak ada member yang cocok dengan pencarian "<%= search %>"
                                            <% } else { %>
                                                Tidak ada data member
                                                <% } %>
                                </td>
                            </tr>
                            <% } else { %>
                                <% members.forEach(member=> { %>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-3">
                                            <div
                                                class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
                                                <% if (member.photo) { %>
                                                    <img src="<%= member.photo %>" alt=""
                                                        class="w-full h-full object-cover">
                                                    <% } else { %>
                                                        <i class="fas fa-user text-gray-400"></i>
                                                        <% } %>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3 font-medium">
                                            <%= member.name %>
                                        </td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">
                                                <%= member.nipp || '-' %>
                                            </span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <% if (member.nias) { %>
                                                <span
                                                    class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs font-medium">
                                                    <%= member.nias %>
                                                </span>
                                                <% } else { %>
                                                    <span class="text-gray-400">-</span>
                                                    <% } %>
                                        </td>
                                        <td class="px-4 py-3">
                                            <% if (member.status==='approved' ) { %>
                                                <span
                                                    class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Approved</span>
                                                <% } else if (member.status==='pending' ) { %>
                                                    <span
                                                        class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">Pending</span>
                                                    <% } else { %>
                                                        <span
                                                            class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs">Rejected</span>
                                                        <% } %>
                                        </td>
                                        <td class="px-4 py-3 text-sm text-gray-600">
                                            <%= new Date(member.created_at).toLocaleDateString('id-ID') %>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex gap-2">
                                                <a href="/admin/members/<%= member.id %>"
                                                    class="text-purple-600 hover:underline text-sm">Detail</a>
                                                <form action="/admin/members/<%= member.id %>/delete" method="POST"
                                                    class="inline" onsubmit="return confirm('Hapus member ini?')">
                                                    <button type="submit"
                                                        class="text-red-600 hover:underline text-sm">Hapus</button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    <% }) %>
                                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <% if (totalPages> 1) { %>
            <div class="mt-6 flex items-center justify-between">
                <div class="text-sm text-gray-500">
                    Halaman <%= currentPage %> dari <%= totalPages %>
                </div>
                <div class="flex gap-2">
                    <% if (currentPage> 1) { %>
                        <a href="/admin/members?page=<%= currentPage - 1 %>&status=<%= currentStatus %><%= search ? '&search=' + search : '' %>"
                            class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50">
                            <i class="fas fa-chevron-left mr-1"></i> Prev
                        </a>
                        <% } %>

                            <% let startPage=Math.max(1, currentPage - 2); let endPage=Math.min(totalPages, currentPage
                                + 2); %>

                                <% if (startPage> 1) { %>
                                    <a href="/admin/members?page=1&status=<%= currentStatus %><%= search ? '&search=' + search : '' %>"
                                        class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50">1</a>
                                    <% if (startPage> 2) { %>
                                        <span class="px-2 py-2 text-gray-400">...</span>
                                        <% } %>
                                            <% } %>

                                                <% for (let i=startPage; i <=endPage; i++) { %>
                                                    <a href="/admin/members?page=<%= i %>&status=<%= currentStatus %><%= search ? '&search=' + search : '' %>"
                                                        class="px-4 py-2 border rounded-lg <%= i === currentPage ? 'bg-purple-600 text-white' : 'bg-white hover:bg-gray-50' %>">
                                                        <%= i %>
                                                    </a>
                                                    <% } %>

                                                        <% if (endPage < totalPages) { %>
                                                            <% if (endPage < totalPages - 1) { %>
                                                                <span class="px-2 py-2 text-gray-400">...</span>
                                                                <% } %>
                                                                    <a href="/admin/members?page=<%= totalPages %>&status=<%= currentStatus %><%= search ? '&search=' + search : '' %>"
                                                                        class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50">
                                                                        <%= totalPages %>
                                                                    </a>
                                                                    <% } %>

                                                                        <% if (currentPage < totalPages) { %>
                                                                            <a href="/admin/members?page=<%= currentPage + 1 %>&status=<%= currentStatus %><%= search ? '&search=' + search : '' %>"
                                                                                class="px-4 py-2 bg-white border rounded-lg hover:bg-gray-50">
                                                                                Next <i
                                                                                    class="fas fa-chevron-right ml-1"></i>
                                                                            </a>
                                                                            <% } %>
                </div>
            </div>
            <% } %>

                <div class="mt-6">
                    <a href="/admin/dashboard" class="text-purple-600 hover:underline">
                        <i class="fas fa-arrow-left mr-2"></i>Kembali ke Dashboard
                    </a>
                </div>
    </div>
</section>